<title>CS140 Practice Lab - AVL Trees</title>
<body bgcolor=ffffff>
<h2>CS140 Practice Lab - AVL Trees</h2>
<UL>
<LI><a href=http://www.cs.utk.edu/~plank>James S. Plank</a>
</i>
</UL>
<hr>

<h3>AVLTree.cpp</h3>

Your job is to implement AVL trees in <b>avltree.cpp</b>.
You should implement it according to the rules outlined in  the
<a href=http://web.eecs.utk.edu/~plank/plank/classes/cs140/Notes/AVL-Trees/index.html>lecture
notes on AVL Trees</a>.
<p>
The header file for AVL trees is in 
<b><a href=avltree.h>avltree.h</a></b>:

<p><center><table border=3 cellpadding=3><td><pre>
#include &lt;iostream&gt;
#include &lt;vector&gt;
using namespace std;

class AVLTNode {
  public:
    AVLTNode *left;
    AVLTNode *right;
    AVLTNode *parent;
    int height;
    string key;
    void *val;
};

class AVLTree {
  public:
    AVLTree();
    ~AVLTree();
    int Insert(string key, void *val);
    void *Find(string key);
    int Delete(string key);
    void Print();
    int Size();
    int Empty();
    vector &lt;void *&gt; Sorted_Vector();
  protected:
    AVLTNode *sentinel;
    int size;
    vector &lt;void *&gt; array;

    void Check_Balance(AVLTNode *n);
    AVLTNode *Rebalance(AVLTNode *n);
    void Rotate(AVLTNode *n);
   
    void recursive_inorder_print(int level, AVLTNode *n);
    void recursive_make_vector(AVLTNode *n);
    void recursive_destroy(AVLTNode *n);

};
</pre></td></table></center><p>

The public methods are exactly the same as the Binary Search Tree data
structure from the lecture notes.  There are just four differences:
<p>
<OL>
<LI> Each node has a <i>height</i> field.
<LI> There is a protected method called <b>Rotate(n)</b>.  It should perform
a rotation about node <i>n</i>, updating all pointers and heights of all
relevant nodes.
<LI> There is a protected method called <b>Rebalance(n)</b>.  It should
check to see if a node is balanced.  If it is, it should just return <i>n</i>.
If it is not balanced, then it should rebalance it by properly identifying
and performing the type of rebalance (Zig-Zig or Zig-Zag), and then returning
the root of the new subtree.

<LI> There is a protected method called <b>Check_Balance(n)</b>.  Its job is
to set the height of node <i>n</i>, and then to set <i>n</i> equal to <b>Rebalance(n)</b>. 
If the new height of <i>n</i> is different from its old height, then it should
continue checking <i>n->parent</i>.  If not, it can return.
</OL>

Now, when you perform insertion to create a node <i>n</i>, call <b>Check_Balance(<i>n->parent</i>)</b>.  That will identify whether rebalancing is necessary on any node up to the root, and
it will perform the rebalancing.
<p>
When you perform deletion on <i>n</i>, use <b>Check_Balance()</b> to fix the balancing
when you're done.  If you order your operations correctly, you can simply make a recursive
call to <b>Delete()</b> when <i>n</i> has two children.
<p>
The only traversal that you should modify from the lecture nodes is
<b>recursive_inorder_print()</b>.  It should print the height of each node before it 
prints its keys.
<p>
The other traversals will be unchanged from the lecture notes on 
binary search trees.
Test your code with <b>avltree_test</b>:

<pre>
UNIX> <font color=darkred><b>avltree_test 'AVL>'</b></font>
AVL> <font color=darkred><b>INSERT Fred 0 0</b></font>
AVL> <font color=darkred><b>INSERT Luther 1 1</b></font>
AVL> <font color=darkred><b>PRINT         </b></font>
  0 Luther
1 Fred
AVL> <font color=darkred><b>INSERT Xavier 2 2</b></font>
AVL> <font color=darkred><b>PRINT</b></font>
  0 Xavier
1 Luther
  0 Fred
AVL> <font color=darkred><b>INSERT Binky 3 3</b></font>
AVL> <font color=darkred><b>INSERT Daisy 4 4</b></font>
AVL> <font color=darkred><b>PRINT</b></font>
  0 Xavier
2 Luther
    0 Fred
  1 Daisy
    0 Binky
AVL> <font color=darkred><b>DELETE Xavier</b></font>
AVL> <font color=darkred><b>PRINT</b></font>
  1 Luther
    0 Fred
2 Daisy
  0 Binky
AVL> <font color=darkred><b>QUIT</b></font>
UNIX> <font color=darkred><b></b></font>
</pre>

I have an executable <b>avltree_test_help</b> that prints
out when it detects imbalances, and when it performs
rotations.  Here is the same set of commands as above:

<pre>
UNIX> <font color=darkred><b>avltree_test_help 'AVL>'</b></font>
AVL> <font color=darkred><b>INSERT Fred 0 0</b></font>
AVL> <font color=darkred><b>INSERT Luther 1 1</b></font>
AVL> <font color=darkred><b>PRINT  </b></font>
  0 Luther
1 Fred
AVL> <font color=darkred><b>INSERT Xavier 2 2</b></font>
Zig-zig imbalance rooted by Fred
Rotate about Luther
AVL> <font color=darkred><b>PRINT</b></font>
  0 Xavier
1 Luther
  0 Fred
AVL> <font color=darkred><b>INSERT Binky 3 3</b></font>
AVL> <font color=darkred><b>INSERT Daisy 4 4</b></font>
Zig-zag imbalance rooted by Fred
Rotate about Daisy
Rotate about Daisy
AVL> <font color=darkred><b>PRINT</b></font>
  0 Xavier
2 Luther
    0 Fred
  1 Daisy
    0 Binky
AVL> <font color=darkred><b>DELETE Xavier</b></font>
Zig-zig imbalance rooted by Luther
Rotate about Daisy
AVL> <font color=darkred><b>PRINT</b></font>
  1 Luther
    0 Fred
2 Daisy
  0 Binky
AVL> <font color=darkred><b>QUIT</b></font>
UNIX>
</pre>

